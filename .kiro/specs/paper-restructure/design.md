# 设计文档

## 概述

本设计文档描述如何将现有因果发现论文重整为符合顶刊标准的格式。重整工作涉及论文结构调整、实验部分逻辑重组、表格图表优化、文本表述专业化等多个方面。

### 设计目标

1. **结构规范化**：按照顶刊（JMLR/TPAMI/NMI）标准重组论文结构
2. **逻辑清晰化**：将现有实验按研究问题重新组织，形成清晰的论证链
3. **表述专业化**：用学术散文替代列点，增加表格和图表
4. **数据完整性**：确保所有实验数据准确反映在论文中

### 核心原则

- **保留原有内容**：不删除任何实验结果，只进行重组和优化
- **增强可读性**：通过表格整合分散的数据，通过图表可视化关键发现
- **突出核心贡献**：强调"统计推理超越语义记忆"这一发现——我们的方法使用实际数据的统计特征进行真正的因果推理，而非依赖LLM的预训练记忆，在复杂网络上更可靠、更可泛化

## 架构

### 论文整体结构

```
论文
├── 摘要 (Abstract)
├── 1. 引言 (Introduction)
├── 2. 相关工作 (Related Work)
├── 3. 方法论 (Methodology)
├── 4. 实验 (Experiments)
├── 5. 讨论 (Discussion)
├── 6. 结论 (Conclusion)
└── 附录 (Appendix)
```

### 实验部分叙事逻辑

实验部分需要讲述一个完整的故事，回答以下核心问题：

**故事主线：ACR-Hybrid是否有效？为什么有效？在什么条件下有效？**

```
4. 实验
│
├── 4.1 实验设置
│   └── 回答：我们用什么数据、指标、基线来验证？
│
├── 4.2 主要结果：ACR-Hybrid是否有效？
│   ├── 4.2.1 合成数据验证 → 证明ACR引擎能正确识别因果方向
│   └── 4.2.2 真实网络性能 → 证明完整流水线在实际场景中有效
│
├── 4.3 核心发现：为什么统计推理比语义记忆更可靠？
│   ├── 4.3.1 与SOTA方法对比 → 在复杂网络上，统计推理显著优于语义记忆
│   └── 4.3.2 语义记忆的局限性 → 语义方法在简单网络上好是因为"背诵"，复杂网络上失效
│
└── 4.4 方法分析：ACR-Hybrid为什么有效？在什么条件下有效？
    ├── 4.4.1 保守策略有效性 → 证明"信任统计、补充认知"的设计原则
    ├── 4.4.2 StatTranslator消融 → 证明自然语言叙事对激发LLM推理能力的关键作用
    ├── 4.4.3 可扩展性 → 证明方法在大规模网络上仍然有效
    ├── 4.4.4 鲁棒性 → 证明方法在低样本量下仍然有效
    └── 4.4.5 通用性 → 证明ACR可以与不同骨架算法结合
```

## 实验数据清单

### 数据集1：合成数据实验
**目的**：验证ACR引擎的微观推理能力
**数据规模**：5类数据，每类1000样本

| 数据类型 | 真实因果 | ACR预测 | 置信度 | 正确 |
|---------|---------|---------|-------|------|
| LiNGAM | A→B | A→B | High | ✓ |
| ANM | A→B | A→B | High | ✓ |
| Reverse | B→A | B→A | High | ✓ |
| Independent | A⊥B | A⊥B | High | ✓ |
| Confounder | A←Z→B | A→B | High | ✗ |

**呈现方式**：表格（表1）
**叙事作用**：证明ACR引擎在已知因果结构的数据上能正确识别方向，为后续真实网络实验奠定基础

---

### 数据集2：真实网络综合结果
**目的**：验证完整流水线在实际场景中的有效性
**数据规模**：8个贝叶斯网络基准

| 方法 | Sprinkler(4) | Asia(8) | Sachs(11) | Child(20) | Insurance(27) | Alarm(37) | Hailfinder(56) | Hepar II(70) |
|-----|-------------|---------|-----------|-----------|---------------|-----------|----------------|--------------|
| ACR-Hybrid | 3 | **5** | **4** | **6** | **9** | **8** | 40 | **17** |
| PC | **0** | 12 | 29 | 14 | 39 | 75 | - | 117 |
| HillClimb | 2 | 16 | 24 | 16 | 31 | 85 | - | 100 |
| Random | 6 | 16 | 30 | 50 | 104 | 84 | 132 | 246 |

**呈现方式**：表格（表2）+ 柱状图（图2）
**叙事作用**：展示ACR-Hybrid在大多数网络上显著优于基线方法，建立方法有效性的主要证据

---

### 数据集3：与SOTA方法对比
**目的**：证明统计推理比语义记忆更可靠
**数据规模**：4个复杂网络

| 方法 | 推理方式 | Alarm | Sachs | Child | Insurance |
|-----|---------|-------|-------|-------|-----------|
| ACR-Hybrid | 统计推理 | **8** | **4** | **6** | **9** |
| PromptBN | 语义记忆 | 41.8 | - | - | 35.6 |
| ReActBN | 语义记忆 | 35.4 | - | 18.0 | 40.2 |
| DiBS+GPT | 语义先验 | - | 21.7 | - | - |

**呈现方式**：表格（表3）+ 对比柱状图（图5）
**叙事作用**：这是论文的核心发现——在复杂网络上，使用实际数据统计特征的方法显著优于依赖语义记忆的SOTA方法。解释原因：语义方法在简单网络上好是因为LLM"背诵"了答案，复杂网络上语义记忆覆盖不到，性能崩塌。

---

### 数据集4：保守策略有效性
**目的**：验证"信任统计、补充认知"的设计原则
**数据规模**：Alarm网络，3种策略

| 策略 | SHD | 定向F1 | 骨架F1 |
|-----|-----|--------|--------|
| PC（基线） | 32 | 0.61 | 0.77 |
| 全量混合 | 35 | 0.58 | 0.77 |
| 保守混合 | **27** | **0.64** | 0.77 |

**呈现方式**：图6左面板（保守策略有效性柱状图）
**叙事作用**：证明保守策略的必要性——全量混合反而比PC更差，因为LLM在PC已正确定向的边上引入了错误。保守混合仅对无向边应用ACR，避免过度修正。

---

### 数据集5：StatTranslator消融
**目的**：验证自然语言叙事对激发LLM推理能力的关键作用
**数据规模**：Alarm网络，46条边

| 设置 | 定向准确率 |
|-----|----------|
| 完整ACR（自然语言叙事） | 89.1% |
| 原始数据（直接输入数值） | 67.4% |
| 随机猜测 | 50.0% |

**呈现方式**：柱状图（图3）- 数据量小，用图更直观
**叙事作用**：证明StatTranslator的关键作用——自然语言形式的统计描述比原始数值更易于LLM理解和推理，提升21.7个百分点。

---

### 数据集6：大规模网络可扩展性
**目的**：验证方法在大规模网络上的有效性
**数据规模**：Hailfinder(56节点)、Hepar II(70节点)

| 网络 | 节点 | 边 | ACR-Hybrid SHD | 准确率 | Unclear比例 |
|-----|-----|---|---------------|--------|------------|
| Hailfinder | 56 | 66 | 40 | 39.4% | ~60% |
| Hepar II | 70 | 123 | 17 | 86.2% | - |

**呈现方式**：图7左面板（网络规模vs准确率折线图）
**叙事作用**：Hepar II证明方法在大规模网络上仍然有效（SHD=17，准确率86.2%）。Hailfinder表现较差，诚实讨论局限性——天气预报网络的因果关系更复杂，统计信号较弱。

---

### 数据集7：低样本量鲁棒性
**目的**：验证方法在低样本量下的有效性
**数据规模**：Asia网络，3种样本量

| 方法 | N=100 | N=500 | N=1000 |
|-----|-------|-------|--------|
| ACR-Hybrid | **0** | **2** | **2** |
| PC | 11 | 8 | 8 |
| HillClimb | 8 | 14 | 8 |

**呈现方式**：图7右面板（样本量vs SHD折线图）
**叙事作用**：证明ACR-Hybrid在低样本量下表现稳定，甚至在N=100时达到完美重建。LLM的统计推理能力可以弥补小样本下统计检验的不稳定性。

---

### 数据集8：基座算法通用性
**目的**：验证ACR可以与不同骨架算法结合
**数据规模**：Asia网络，2种骨架算法

| 方法组合 | SHD |
|---------|-----|
| PC + ACR | **10** |
| MMHC + ACR | **10** |
| MMHC（原始） | 12 |
| PC（原始） | 12 |

**呈现方式**：图6右面板（基座算法通用性柱状图）
**叙事作用**：证明ACR定向策略具有通用性，可以与不同的骨架学习算法结合，均能有效提升性能。

---

## 表格与图表设计

### 表格清单

| 表格编号 | 内容 | 数据来源 | 叙事位置 |
|---------|-----|---------|---------|
| 表1 | 合成数据实验结果 | 数据集1 | 4.2.1 |
| 表2 | 真实网络综合结果 | 数据集2 | 4.2.2 |
| 表3 | 与SOTA方法对比 | 数据集3 | 4.3.1 |

*注：数据集4-8的数据通过图6、图7可视化，不再单独成表，避免数据重复呈现。*

### 图表清单

所有结构图使用Banana绘制，数据图使用Python matplotlib绘制。完成后将图片放入`paper/assets/`目录。

| 图表编号 | 内容 | 数据来源 | 叙事位置 | 绘图方式 |
|---------|-----|---------|---------|---------|
| 图1 | ANM机制说明（残差图） | 方法论示例 | 3.2 | Python matplotlib |
| 图2 | 真实网络SHD柱状图 | 数据集2 | 4.2.2 | Python matplotlib |
| 图3 | StatTranslator消融 | 数据集5 | 4.4.2 | Python matplotlib |
| 图4 | 框架概览图 | 方法论 | 3.3 | Banana |
| 图5 | 统计推理vs语义记忆对比 | 数据集3 | 4.3.1 | Python matplotlib |
| 图6 | 方法分析组合图（保守策略+基座算法） | 数据集4+8 | 4.4.1+4.4.5 | Python matplotlib |
| 图7 | 可扩展性与鲁棒性组合图 | 数据集6+7 | 4.4.3+4.4.4 | Python matplotlib |

### Banana绘图提示词

#### 图4：框架概览图 (fig4_framework)
**文件路径**：`paper/assets/fig4_framework.pdf`
**提示词**：
```
Create a scientific diagram showing a two-stage causal discovery pipeline:

Stage 1 (top): "Skeleton Learning"
- Input: Observational Data (matrix icon)
- Process: PC Algorithm (box)
- Output: PDAG with undirected edges (graph with some directed, some undirected edges)

Stage 2 (bottom): "Conservative Refinement"
- For each undirected edge:
  - Statistical Feature Extraction (HSIC, residual independence)
  - StatTranslator: Convert to natural language narrative
  - LLM Inference: Determine direction or "Unclear"
  - Fallback mechanism: Keep undirected if uncertain

Output: Final DAG

Style: Clean, academic, blue/gray color scheme, arrows showing data flow
```

### 数据图绘制说明

图1、图2、图3、图5使用Python matplotlib绘制，脚本已存在于`figures/`目录：
- `figures/fig1_mechanism_check.py`
- `figures/fig2_performance_gap.py`
- `figures/fig3_ablation.py`
- `figures/fig5_blind_vs_semantic.py`

运行脚本后将生成的PDF复制到`paper/assets/`目录。

### 组合图设计

为充分利用所有数据，将小数据集组合成复合图：

#### 图6：方法分析组合图 (fig6_method_analysis)
将保守策略、基座算法通用性组合成一张双面板图：
- 左面板：保守策略有效性（数据集4）- 柱状图
- 右面板：基座算法通用性（数据集8）- 柱状图

#### 图7：可扩展性与鲁棒性组合图 (fig7_scalability_robustness)
将大规模网络和低样本量组合成一张双面板图：
- 左面板：网络规模vs准确率（数据集6）- 折线图，展示随网络规模增大的性能变化
- 右面板：样本量vs SHD（数据集7）- 折线图，展示随样本量变化的性能

## 数据模型

### 文件修改清单

| 文件 | 修改类型 | 说明 |
|-----|---------|-----|
| paper/abstract.tex | 优化 | 精炼摘要，突出核心发现 |
| paper/sections/01_introduction.tex | 重写 | 用散文替代列点 |
| paper/sections/02_related_work.tex | 优化 | 整合段落 |
| paper/sections/03_methodology.tex | 优化 | 保持现有结构 |
| paper/sections/04_experiments.tex | 重组 | 按新架构重组实验 |
| paper/sections/05_discussion.tex | 精炼 | 聚焦三个方面 |
| paper/sections/06_conclusion.tex | 精炼 | 简化结构 |
| paper/tables.tex | 重写 | 创建5个综合表格 |
| paper/sections/appendix.tex | 扩展 | 添加详细结果 |

## 正确性属性

*正确性属性是指在系统所有有效执行中都应保持为真的特征或行为。*

由于本项目是论文重整任务，主要涉及文档编辑而非软件开发，大部分验收标准需要人工审查。以下是可以通过自动化检查验证的属性：

### 属性1：列点数量减少
*对于任意* LaTeX文件，重整后的itemize/enumerate环境数量应显著少于重整前
**验证: 需求 5.1**

### 属性2：表格数量
*对于任意* 实验部分，重整后应包含5个综合表格
**验证: 需求 3.1, 3.2**

### 属性3：图表引用完整性
*对于任意* 论文正文，应包含对fig1-fig5的完整引用
**验证: 需求 4.1-4.5**

### 属性4：数据完整性
*对于任意* 主结果表，应包含全部8个网络的SHD值，且数值与实验数据一致
**验证: 需求 6.1, 6.2**

### 属性5：术语一致性
*对于任意* 论文正文，方法名称应统一使用"ACR-Hybrid"
**验证: 需求 5.5**

## 测试策略

### 人工审查（主要）
- 内容质量：段落流畅性、学术语言规范性
- 逻辑结构：实验组织的合理性、叙事的连贯性
- 视觉效果：表格和图表的可读性

### 自动化检查（辅助）
- 结构检查：section/subsection层级
- 数据验证：表格数值与JSON文件一致性
- 格式检查：itemize环境数量、图表引用完整性
